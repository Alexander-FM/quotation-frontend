<div class="p-4">
	<p-toast />
	<p-confirmDialog />

	<div class="card">
		<div class="flex justify-content-between align-items-center mb-4">
			<h2 class="m-0">Gestión de Empleados</h2>
			<p-button label="Nuevo Empleado" icon="pi pi-plus" (onClick)="openNew()" severity="success" />
		</div>

		<p-table [value]="employees" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10,25,50]" [loading]="loading"
			[showCurrentPageReport]="true" currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} empleados"
			[tableStyle]="{ 'min-width': '70rem' }">

			<ng-template pTemplate="header">
				<tr>
					<th style="width: 6%">ID</th>
					<th style="width: 18%">Nombre</th>
					<th style="width: 10%">Tipo Doc.</th>
					<th style="width: 12%">Nro. Documento</th>
					<th style="width: 12%">Teléfono</th>
					<th style="width: 12%">Teléfono 2</th>
					<th style="width: 18%">Dirección</th>
					<th style="width: 12%">Usuario</th>
					<th style="width: 8%">Estado</th>
					<th style="width: 12%">Acciones</th>
				</tr>
			</ng-template>

			<ng-template pTemplate="body" let-emp>
				<tr>
					<td>{{ emp.id }}</td>
					<td>{{ emp.fullName }}</td>
					<td>{{ emp.documentTypeCode }}</td>
					<td>{{ emp.documentNumber }}</td>
					<td>{{ emp.phoneNumber }}</td>
					<td>{{ emp.phoneNumber2 || '-' }}</td>
					<td>{{ emp.streetAddress }}</td>
					<td>{{ emp.userResponseDto?.username || '-' }}</td>
					<td>
						<p-tag [value]="emp.isActive ? 'Activo' : 'Inactivo'" [severity]="emp.isActive ? 'success' : 'danger'" />
					</td>
					<td>
						<p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="info" (onClick)="editEmployee(emp)" class="mr-2" />
						<p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" (onClick)="deleteEmployee(emp)" />
					</td>
				</tr>
			</ng-template>

			<ng-template pTemplate="emptymessage">
				<tr>
					<td colspan="10" class="text-center">No se encontraron empleados</td>
				</tr>
			</ng-template>
		</p-table>
	</div>

	<p-dialog [(visible)]="displayDialog" [header]="isEditMode ? 'Editar Empleado' : 'Nuevo Empleado'" [modal]="true"
		[style]="{ width: '700px' }" [draggable]="false" [resizable]="false">
		<form [formGroup]="employeeForm">
			<div class="flex flex-column gap-3">
				<div class="flex flex-column gap-2">
					<label htmlFor="fullName">Nombre Completo *</label>
					<input pInputText id="fullName" formControlName="fullName" placeholder="Ingrese el nombre completo" />
					<small class="text-red-500" *ngIf="employeeForm.get('fullName')?.invalid && employeeForm.get('fullName')?.touched">
						El nombre completo es requerido
					</small>
				</div>

				<div class="formgrid grid">
					<div class="field col-6">
						<label htmlFor="documentTypeCode">Tipo de Documento *</label>
						<p-select id="documentTypeCode" formControlName="documentTypeCode" [options]="documentTypes"
							optionLabel="code" optionValue="code" placeholder="Seleccione" class="w-full" />
						<small class="text-red-500"
							*ngIf="employeeForm.get('documentTypeCode')?.invalid && employeeForm.get('documentTypeCode')?.touched">
							El tipo de documento es requerido
						</small>
					</div>

					<div class="field col-6">
						<label htmlFor="documentNumber">Número de Documento *</label>
						<input pInputText id="documentNumber" formControlName="documentNumber"
							[maxlength]="employeeForm.get('documentTypeCode')?.value === 'RUC' ? 11 : employeeForm.get('documentTypeCode')?.value === 'DNI' ? 8 : 20"
							placeholder="Ingrese el número" />
						<small class="text-red-500"
							*ngIf="employeeForm.get('documentNumber')?.invalid && employeeForm.get('documentNumber')?.touched">
							<span *ngIf="employeeForm.get('documentTypeCode')?.value === 'RUC'">
								El RUC debe tener exactamente 11 dígitos numéricos
							</span>
							<span *ngIf="employeeForm.get('documentTypeCode')?.value === 'DNI'">
								El DNI debe tener exactamente 8 dígitos numéricos
							</span>
							<span *ngIf="employeeForm.get('documentTypeCode')?.value !== 'RUC' && employeeForm.get('documentTypeCode')?.value !== 'DNI'">
								El número de documento es requerido (máx. 20 caracteres)
							</span>
						</small>
					</div>
				</div>

				<div class="formgrid grid">
					<div class="field col-6">
						<label htmlFor="phoneNumber">Teléfono Principal *</label>
						<input pInputText id="phoneNumber" formControlName="phoneNumber" maxlength="9" placeholder="Ej: 999999999" />
						<small class="text-red-500" *ngIf="employeeForm.get('phoneNumber')?.invalid && employeeForm.get('phoneNumber')?.touched">
							Formato de teléfono inválido (máx. 9), permite dígitos y + - ( ) espacios
						</small>
					</div>

					<div class="field col-6">
						<label htmlFor="phoneNumber2">Teléfono Secundario</label>
						<input pInputText id="phoneNumber2" formControlName="phoneNumber2" maxlength="9" placeholder="Opcional" />
						<small class="text-red-500" *ngIf="employeeForm.get('phoneNumber2')?.invalid && employeeForm.get('phoneNumber2')?.touched">
							Formato inválido (máx. 9), permite dígitos y + - ( ) espacios
						</small>
					</div>
				</div>

				<div class="flex flex-column gap-2">
					<label htmlFor="streetAddress">Dirección *</label>
					<input pInputText id="streetAddress" formControlName="streetAddress" placeholder="Ingrese la dirección" />
					<small class="text-red-500" *ngIf="employeeForm.get('streetAddress')?.invalid && employeeForm.get('streetAddress')?.touched">
						La dirección es requerida
					</small>
				</div>

				<div class="flex flex-column gap-2">
					<label htmlFor="userId">Usuario *</label>
					<p-select id="userId" formControlName="userId" [options]="users" optionLabel="username" optionValue="id"
						placeholder="Seleccione" class="w-full" />
					<small class="text-red-500" *ngIf="employeeForm.get('userId')?.invalid && employeeForm.get('userId')?.touched">
						Debe seleccionar un usuario
					</small>
				</div>

				<div class="flex align-items-center gap-2">
					<p-checkbox formControlName="isActive" [binary]="true" inputId="isActive" />
					<label htmlFor="isActive">Activo</label>
				</div>
			</div>

			<div class="flex justify-content-end gap-2 mt-4">
				<p-button label="Cancelar" severity="secondary" (onClick)="hideDialog()" type="button" />
				<p-button label="Guardar" (onClick)="saveEmployee()" [disabled]="employeeForm.invalid" />
			</div>
		</form>
	</p-dialog>
</div>

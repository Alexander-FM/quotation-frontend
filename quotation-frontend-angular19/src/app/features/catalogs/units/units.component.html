<p-toast position="top-right"></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="card">
  <div class="flex align-items-center justify-content-between mb-3">
    <h2 class="m-0">Unidades de Medida</h2>
    <p-button icon="pi pi-plus" label="Nueva Unidad" (onClick)="openDialog()" severity="success"></p-button>
  </div>

  <p-table [value]="units" [loading]="loading" responsiveLayout="scroll" styleClass="p-datatable-striped">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name">Nombre <p-sortIcon field="name"></p-sortIcon></th>
        <th pSortableColumn="description">Descripción <p-sortIcon field="description"></p-sortIcon></th>
        <th pSortableColumn="isActive">Estado <p-sortIcon field="isActive"></p-sortIcon></th>
        <th>Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-unit>
      <tr>
        <td>{{ unit.name }}</td>
        <td>{{ unit.description || '-' }}</td>
        <td>
          <p-tag [value]="unit.isActive ? 'Activo' : 'Inactivo'"
                 [severity]="unit.isActive ? 'success' : 'danger'"></p-tag>
        </td>
        <td>
          <div class="flex gap-2">
            <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="info"
                      (onClick)="editUnit(unit)" pTooltip="Editar" tooltipPosition="top"></p-button>
            <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
                      (onClick)="deleteUnit(unit)" pTooltip="Eliminar" tooltipPosition="top"></p-button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center p-4">
          <span class="text-color-secondary">No hay unidades registradas</span>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Diálogo de Crear/Editar -->
<p-dialog [(visible)]="dialogVisible"
          [header]="isEditMode ? 'Editar Unidad' : 'Nueva Unidad'"
          [modal]="true"
          [closable]="true"
          (onHide)="closeDialog()"
          [style]="{ width: '100%', maxWidth: '500px' }">

  <form [formGroup]="form">
    <div class="field mb-3">
      <label for="name" class="block mb-2 font-bold">Nombre *</label>
      <input id="name" type="text" pInputText formControlName="name" class="w-full"
             placeholder="Ej: Kilogramos" />
      <small class="p-error block mt-1"
             *ngIf="form.get('name')?.invalid && form.get('name')?.touched">
        El nombre es requerido y debe tener al menos 3 caracteres
      </small>
    </div>

    <div class="field mb-3">
      <label for="description" class="block mb-2 font-bold">Descripción</label>
      <textarea id="description" pInputTextarea formControlName="description"
                class="w-full" rows="3"
                placeholder="Ej: Unidad de peso..."></textarea>
    </div>

    <div class="field mb-3 flex align-items-center">
      <p-inputSwitch formControlName="isActive"></p-inputSwitch>
      <label for="isActive" class="ml-2">Activo</label>
    </div>

    <div class="flex gap-2 justify-content-end">
      <p-button label="Cancelar" severity="secondary" (onClick)="closeDialog()" type="button"></p-button>
      <p-button label="Guardar" severity="success" (onClick)="saveUnit()" type="button"></p-button>
    </div>
  </form>
</p-dialog>
